
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Plane Waves &#8212; JAX-based Differentiable Density Functional Theory Framework for Materials  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=482e77ab" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=482e77ab" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/graph.js?v=c5fa36a6"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>window.MathJax = {"loader": {"load": ["[tex]/physics"]}, "tex": {"packages": {"[+]": ["physics"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api/core/pw';</script>
    <link rel="icon" href="../../_static/jrystal_logo.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.0.1" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/jrystal_logo.png" class="logo__image only-light" alt="JAX-based Differentiable Density Functional Theory Framework for Materials  documentation - Home"/>
    <img src="../../_static/jrystal_logo.png" class="logo__image only-dark pst-js-only" alt="JAX-based Differentiable Density Functional Theory Framework for Materials  documentation - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../examples/index.html">Examples</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../examples/crystal.html">Create A Crystal Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/dft100lines.html">DFT Total Energy Calculation in Less than 50 Lines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/band_structure.html">Band Structure Calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../examples/config.html">Command Line Interface and Configuration</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../tutorial/index.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/crystallography.html">An Introduction to Crystallography</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/array_shape.html">Understanding Variable Shapes in <code class="docutils literal notranslate"><span class="pre">jrystal</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/total_energy.html">Total energy minimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/differentiation.html">What Can Differentiation Do for Density Functional Theory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/equivalence.html">Equivalence Between Total Energy Minimization and Solving Kohn-Sham Equation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../tutorial/occupation.html">How Do We Deal with Occupation Numbers in Direct Optimization?</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../index.html">API Documentation</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../energy.html">Energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pseudopotential.html">Pseudopotential</a></li>
<li class="toctree-l2"><a class="reference internal" href="../calc.html">Calculator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html">Utilities</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Feature Roadmap and Contribution Guide</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/api/core/pw.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Plane Waves</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.coeff"><code class="docutils literal notranslate"><span class="pre">coeff()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.density_grid"><code class="docutils literal notranslate"><span class="pre">density_grid()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.density_grid_reciprocal"><code class="docutils literal notranslate"><span class="pre">density_grid_reciprocal()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.density_r"><code class="docutils literal notranslate"><span class="pre">density_r()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.nabla_density_grid"><code class="docutils literal notranslate"><span class="pre">nabla_density_grid()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.nabla_density_r"><code class="docutils literal notranslate"><span class="pre">nabla_density_r()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.param_init"><code class="docutils literal notranslate"><span class="pre">param_init()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.wave_grid"><code class="docutils literal notranslate"><span class="pre">wave_grid()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.wave_r"><code class="docutils literal notranslate"><span class="pre">wave_r()</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="module-jrystal._src.pw">
<span id="plane-waves"></span><h1>Plane Waves<a class="headerlink" href="#module-jrystal._src.pw" title="Link to this heading">#</a></h1>
<p>Planewave module.</p>
<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.coeff">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">coeff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pw_param</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Array</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.13)"><span class="pre">Tuple</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_mask</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bool</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#jrystal._src.pw.coeff" title="Link to this definition">#</a></dt>
<dd><p>Create the linear coefficients to combine the frequency components.</p>
<p>This function takes a raw parameter of shape
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_g,</span> <span class="pre">num_bands)</span></code>, orthogonalize for the last
two dimensions, so that the resulting tensor satisfies the unitary constraint
<code class="code docutils literal notranslate"><span class="pre">einsum('kabc,labc-&gt;kl',</span> <span class="pre">ret[i,</span> <span class="pre">j],</span> <span class="pre">ret[i,</span> <span class="pre">j])</span> <span class="pre">==</span> <span class="pre">eye(num_bands)</span></code>.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">pw_param</span></code> should be created from <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a>, and the same
<code class="code docutils literal notranslate"><span class="pre">freq_mask</span></code> used in <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> should be used here. As mentioned
in <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a>, we use linear combination over 3D fourier
components for creating wave functions. Some extra requirements are</p>
<ol class="arabic simple">
<li><p>The wave functions that has the same spin and same k component needs
to be orthogonal to each other.</p></li>
<li><p>We only activate some of the frequency components with the <code class="code docutils literal notranslate"><span class="pre">freq_mask</span></code>.</p></li>
</ol>
<p>As the raw parameter returned from <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> has the shape
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_g,</span> <span class="pre">num_bands)</span></code>, where <code class="code docutils literal notranslate"><span class="pre">num_g</span></code> is the number of
activated frequencies flattend from the activated entries in the <code class="code docutils literal notranslate"><span class="pre">freq_mask</span></code>
This function first orthogonalize over the last two dimensions and
reorganize the orthogonalized parameter into a 3D grid the same shape of
the frequency mask.</p>
<p>Extension reads:
1. Why and how to mask the frequency components.
2. Bloch theorum.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pw_param</strong> – the raw parameter, maybe created from</p>
</dd>
</dl>
<p>:param <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a>.:
:param freq_mask: a 3D mask to select the frequency components.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Complex array of shape <code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_band,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.
It satisfies the unitary constraint that for any <code class="code docutils literal notranslate"><span class="pre">i,j</span></code>
<code class="code docutils literal notranslate"><span class="pre">einsum('kabc,labc-&gt;kl',</span> <span class="pre">ret[i,</span> <span class="pre">j],</span> <span class="pre">ret[i,</span> <span class="pre">j])</span></code> is an identity matrix.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.density_grid">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">density_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">occupation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Int</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#jrystal._src.pw.density_grid" title="Link to this definition">#</a></dt>
<dd><p>Compute the density at the spatial grid.</p>
<p>In a system with electrons, the density of the electron is the result of
multiple wave functions overlapping in the space. As we mention in
<a class="reference internal" href="#jrystal._src.pw.wave_grid" title="jrystal._src.pw.wave_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">wave_grid()</span></code></a>, the wave function is a linear combination of 3D fourier
components. To compute the density, usually we only need to take the absolute
square of each wave function and sum them up.</p>
<div class="math notranslate nohighlight">
\[\rho(r) = \sum_i |\psi_i(r)|^2\]</div>
<p>This function evaluates the density <span class="math notranslate nohighlight">\(\rho(r)\)</span> as the spatial grid
generated from the <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.r_vectors()</span></code>.</p>
<p>In crystals, this is a little bit more complicated. The form of the wave
function is</p>
<div class="math notranslate nohighlight">
\[\psi(r) = \frac{1}{\sqrt{\Omega_\text{cell}}} e^{ikr} \sum_G c_{kG}
e^{iGr}\]</div>
<p>The <span class="math notranslate nohighlight">\(c_{kG}\)</span> can be computed from <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a>
and <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a>. For calculation of density, we only need
the <span class="math notranslate nohighlight">\(c_{kG}\)</span> and the occupation <span class="math notranslate nohighlight">\(o_k\)</span> over <span class="math notranslate nohighlight">\(k\)</span>.</p>
<div class="math notranslate nohighlight">
\[\rho(r) = \frac{1}{\Omega_\text{cell}} e^{ikr} \sum_G c_{kG}
e^{iGr}\]</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coeff</strong> – <span class="math notranslate nohighlight">\(c_{kG}\)</span> part of the parameter. It can have a leading batch dimension
which will be summed to get the overall density.
Therefore the shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.</p></li>
<li><p><strong>vol</strong> – volume of the unit cell, a real scalar.</p></li>
<li><p><strong>occupation</strong> – the occupation over different k frequencies.
The shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands)</span></code>, it should have the same leading dimension
as <code class="code docutils literal notranslate"><span class="pre">coeff</span></code>.
This is an option argument, when <code class="code docutils literal notranslate"><span class="pre">occupation=None</span></code>, we compute the density
contribution from each <span class="math notranslate nohighlight">\(k\)</span> without summing them. If <code class="code docutils literal notranslate"><span class="pre">occupation</span></code> is
provided, we sum up all the density from each <span class="math notranslate nohighlight">\(k\)</span> weighted by the
occupation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A real valued tensor that represents the density at the spatial grid
computed from <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.r_vectors()</span></code>.
The shape is <code class="code docutils literal notranslate"><span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)</span></code> if <code class="code docutils literal notranslate"><span class="pre">occupation</span></code> is provided,
else the shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.density_grid_reciprocal">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">density_grid_reciprocal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Array</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">occupation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Int</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#jrystal._src.pw.density_grid_reciprocal" title="Link to this definition">#</a></dt>
<dd><p>Fourier transform of the density grid.</p>
<p>In a system with electrons, the density of the electron is the result of
multiple wave functions overlapping in the space. As we mention in
<a class="reference internal" href="#jrystal._src.pw.wave_grid" title="jrystal._src.pw.wave_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">wave_grid()</span></code></a>, the wave function is a linear combination of 3D fourier
components. To compute the density, usually we only need to take the absolute
square of each wave function and sum them up.</p>
<div class="math notranslate nohighlight">
\[\rho(r) = \sum_i |\psi_i(r)|^2\]</div>
<p><a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a> computes the density <span class="math notranslate nohighlight">\(\rho(r)\)</span> at the spatial grid
generated from <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.r_vectors()</span></code>.</p>
<p>The fourier transformation of <span class="math notranslate nohighlight">\(\rho(r)\)</span> is</p>
<div class="math notranslate nohighlight">
\[\tilde{\rho}(G) = \int \rho(r) e^{-iGr} dr\]</div>
<p>We can also evaluate the <span class="math notranslate nohighlight">\(\tilde{\rho}(G)\)</span> at any <span class="math notranslate nohighlight">\(G\)</span>, but this function
computes the <span class="math notranslate nohighlight">\(\tilde{\rho}(G)\)</span> evaluated at the grid generated from
<code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>. It is equivalent to computing the <span class="math notranslate nohighlight">\(\rho(r)\)</span>
at <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.r_vectors()</span></code> and then do the discrete fourier
transform.</p>
<p>Since this function is just composing FFT with <a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a>,
we refer you to <a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a> for more details.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coeff</strong> – coefficients of the wave functions.</p></li>
<li><p><strong>vol</strong> – volume of the unit cell.</p></li>
<li><p><strong>occupation</strong> – occupation over the different <span class="math notranslate nohighlight">\(k\)</span> components, see more in
<a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A complex valued tensor representing <span class="math notranslate nohighlight">\(\tilde{\rho}(G)\)</span> evaluated at <span class="math notranslate nohighlight">\(G\)</span>
generated from <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.density_r">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">density_r</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_vectors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3</span> <span class="pre">3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_vector_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">occupation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Int</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#jrystal._src.pw.density_r" title="Link to this definition">#</a></dt>
<dd><p>Compute the electron density at location r.</p>
<p><a class="reference internal" href="#jrystal._src.pw.wave_r" title="jrystal._src.pw.wave_r"><code class="xref py py-func docutils literal notranslate"><span class="pre">wave_r()</span></code></a> computes the electron density at location <span class="math notranslate nohighlight">\(r\)</span>.
This function computes the density at location <span class="math notranslate nohighlight">\(r\)</span>. If occupation is
not provided, it simply returns the absolute square of the <a class="reference internal" href="#jrystal._src.pw.wave_r" title="jrystal._src.pw.wave_r"><code class="xref py py-func docutils literal notranslate"><span class="pre">wave_r()</span></code></a>.
If occupation is provided, the <code class="code docutils literal notranslate"><span class="pre">coeff</span></code> needs to have a shape of
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>, the <code class="code docutils literal notranslate"><span class="pre">occupation</span></code>
needs to have the dimension of the <code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands)</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> – spatial location to evaluate the density, shape: (3,).</p></li>
<li><p><strong>coeff</strong> – wave function coefficients, which has a shape of
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.
it can be created from <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> followed by <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a>.</p></li>
<li><p><strong>cell_vectors</strong> – the cell vectors of the crystal unit cell.</p></li>
<li><p><strong>g_vector_grid</strong> – the G vectors computed from
<code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>.</p></li>
<li><p><strong>occupation</strong> – occupation over different k frequencies.
Refer to <a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a> for more information.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A real scalar that represents the density at location r.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.nabla_density_grid">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">nabla_density_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_vectors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3</span> <span class="pre">3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_vector_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">occupation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Int</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#jrystal._src.pw.nabla_density_grid" title="Link to this definition">#</a></dt>
<dd><p>Compute the first order derivative of the density at a specific grid of
spatial locations.</p>
<p>Refer the <a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a> for more information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coeff</strong> – <span class="math notranslate nohighlight">\(c_{kG}\)</span> part of the parameter. It can have a leading batch dimension
which will be summed to get the overall density.
Therefore the shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.</p></li>
<li><p><strong>vol</strong> – volume of the unit cell, a real scalar.</p></li>
<li><p><strong>occupation</strong> – the occupation over different k frequencies.
The shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands)</span></code>, it should have the same leading dimension
as <code class="code docutils literal notranslate"><span class="pre">coeff</span></code>.
This is an option argument, when <code class="code docutils literal notranslate"><span class="pre">occupation=None</span></code>, we compute the density
contribution from each <span class="math notranslate nohighlight">\(k\)</span> without summing them. If <code class="code docutils literal notranslate"><span class="pre">occupation</span></code> is
provided, we sum up all the density from each <span class="math notranslate nohighlight">\(k\)</span> weighted by the
occupation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A real valued tensor that represents the density derivative at the spatial
grid computed from <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.r_vectors()</span></code>.
The shape is <code class="code docutils literal notranslate"><span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z,</span> <span class="pre">3)</span></code> if <code class="code docutils literal notranslate"><span class="pre">occupation</span></code> is provided,
else the shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z,</span> <span class="pre">3)</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.nabla_density_r">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">nabla_density_r</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_vectors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3</span> <span class="pre">3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_vector_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">occupation</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Int</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#jrystal._src.pw.nabla_density_r" title="Link to this definition">#</a></dt>
<dd><p>Compute the first order derivative of the density at location r.</p>
<p>Refer the <a class="reference internal" href="#jrystal._src.pw.density_r" title="jrystal._src.pw.density_r"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_r()</span></code></a> for more information.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> – spatial location to evaluate the density, shape: (3,).</p></li>
<li><p><strong>coeff</strong> – wave function coefficients, which has a shape of
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_bands,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.
it can be created from <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> followed by <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a>.</p></li>
<li><p><strong>cell_vectors</strong> – the cell vectors of the crystal unit cell.</p></li>
<li><p><strong>g_vector_grid</strong> – the G vectors computed from
<code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>.</p></li>
<li><p><strong>occupation</strong> – occupation over different k frequencies.
Refer to <a class="reference internal" href="#jrystal._src.pw.density_grid" title="jrystal._src.pw.density_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">density_grid()</span></code></a> for more information.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A <code class="code docutils literal notranslate"><span class="pre">(3,)</span></code> real vector that represents the density derivative at</dt><dd><p>location <code class="code docutils literal notranslate"><span class="pre">r</span></code>.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.param_init">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">param_init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_bands</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_kpts</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">freq_mask</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Bool</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spin_restricted</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#jrystal._src.pw.param_init" title="Link to this definition">#</a></dt>
<dd><p>Initialize the raw parameters.</p>
<p>This function generates a random tensor of shape
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_g,</span> <span class="pre">num_bands)</span></code>, where <code class="code docutils literal notranslate"><span class="pre">num_g</span></code> is the
number of <code class="code docutils literal notranslate"><span class="pre">True</span></code> items in the <code class="code docutils literal notranslate"><span class="pre">freq_mask</span></code>.</p>
<p>In planewave based calculation, a wave function is represented as a
linear combination of the fourier series in 3D. Therefore to create one
wave function we need a 3D shaped tensor to represent the mixing
coefficients on each of the frequency component (denoted as <code class="code docutils literal notranslate"><span class="pre">G</span></code>).
<code class="code docutils literal notranslate"><span class="pre">freq_mask</span></code> provides a 3D mask to decide which frequency components
are selected, the number of selected components is denoted as <code class="code docutils literal notranslate"><span class="pre">num_g</span></code>.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">num_bands</span></code> &amp; <code class="code docutils literal notranslate"><span class="pre">num_kpts</span></code> is a bit hard to explain, intuitively,
the wave functions consists of high frequency components that has a period
smaller than the unit cell (denoted <span class="math notranslate nohighlight">\(G\)</span>) and components that has a period
larger than the unit cell (denoted <span class="math notranslate nohighlight">\(k\)</span>).</p>
<p>The form of wave function under solid state</p>
<div class="math notranslate nohighlight">
\[\psi(r) = e^{ikr}\sum_G c_{kG} e^{iGr}\]</div>
<p>This function generates a raw parameter, which after processing by
<a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a> can be used as the <span class="math notranslate nohighlight">\(c_{kG}\)</span> part of the above equation.</p>
<p>Extension reads:
1. Why and how to mask the frequency components.
2. Bloch theorum.</p>
<p>As far as this function is concerned, it simply just returns a randomly
initialized parameter of shape <code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_g,</span> <span class="pre">num_bands)</span></code>.
The input arguments to this function is only used to determine the shape.</p>
<p>Note that this function returns the raw parameter that can not be used
directly to weight the frequency components, as in quantum chemistry we
require the wave functions to be orthogonal to each other.
check <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a> for converting the raw parameter into an unitary
tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – random key for initializing the parameters.</p></li>
<li><p><strong>num_bands</strong> – the number of bands.</p></li>
<li><p><strong>num_kpts</strong> – the number of k points.</p></li>
<li><p><strong>freq_mask</strong> – a 3D mask that denotes which frequency components are selected.</p></li>
<li><p><strong>spin_restricted</strong> – if <code class="code docutils literal notranslate"><span class="pre">True</span></code>, <code class="code docutils literal notranslate"><span class="pre">num_spin=2</span></code> else <code class="code docutils literal notranslate"><span class="pre">num_spin=1</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A complex type raw parameter of shape
<code class="code docutils literal notranslate"><span class="pre">(num_spin,</span> <span class="pre">num_kpts,</span> <span class="pre">num_g,</span> <span class="pre">num_bands)</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.wave_grid">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">wave_grid</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Array</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#jrystal._src.pw.wave_grid" title="Link to this definition">#</a></dt>
<dd><p>Wave function evaluated at a grid of spacial locations.</p>
<p>This function implements the <span class="math notranslate nohighlight">\(U(r)\)</span> part of the bloch wave function.</p>
<div class="math notranslate nohighlight">
\[U(r)=\frac{1}{\sqrt{\Omega_\text{cell}}} \sum_G c_{G} e^{iG^\top r}\]</div>
<p><span class="math notranslate nohighlight">\(G\)</span> is the 3D frequency components, <span class="math notranslate nohighlight">\(\Omega_\text{cell}\)</span> is the
volume of the crystal unit cell, which is to make sure the wave function is
normalized within the cell.</p>
<p>where <span class="math notranslate nohighlight">\(c\)</span> is the linear coefficient. It combines over different
<span class="math notranslate nohighlight">\(G\)</span> components that is generated with <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>.
We can evaluate the wave function at any spatial location <span class="math notranslate nohighlight">\(r\)</span> which takes
<span class="math notranslate nohighlight">\(O(|G|)\)</span> computation. However, if we evaluate this function on a specific
spatial grid of size <span class="math notranslate nohighlight">\(|G|\)</span>, we can be faster than <span class="math notranslate nohighlight">\(O(|G|^2)\)</span> by using
fourier transform. IFFT gives us an <span class="math notranslate nohighlight">\(O(|G|\log(|G|))\)</span> implementation of the
above equation. The <span class="math notranslate nohighlight">\(G\)</span> and <span class="math notranslate nohighlight">\(R\)</span> grid can be obtained from
<code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code> and <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.r_vectors()</span></code>
correspondingly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">G</span> <span class="o">=</span> <span class="n">jrystal</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">g_vectors</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># (x y z, 3)</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">jrystal</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">r_vectors</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># (x y z, 3)</span>
<span class="n">coefficients</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># (x y z)</span>
<span class="n">vol</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">wave_function</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">coefficients</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">G</span> <span class="o">@</span> <span class="n">r</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

<span class="c1"># The following is O(|G|^2)</span>
<span class="n">wave_at_R_naive</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">wave_function</span><span class="p">)))(</span><span class="n">R</span><span class="p">)</span>
<span class="c1"># The following is O(|G|log|G|)</span>
<span class="n">wave_at_R_fft</span> <span class="o">=</span> <span class="n">wave_grid</span><span class="p">(</span><span class="n">coefficients</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>
</pre></div>
</div>
<p>As IFFT implements</p>
<div class="math notranslate nohighlight">
\[x_n = \frac{1}{N} \sum_{k=0}^{N-1} X_k e^{i\frac{2\pi}{N}kn}\]</div>
<p>It is a bit different from the definition of the wave function,
if you check the code, we do two things to align them,</p>
<p>1. we multiply back the <span class="math notranslate nohighlight">\(N\)</span> to cancel the <span class="math notranslate nohighlight">\(\frac{1}{N}\)</span>
factor in the IFFT (in 3D the <code class="code docutils literal notranslate"><span class="pre">np.prod(grid_sizes)</span></code>).
2. we divide by the <span class="math notranslate nohighlight">\(\sqrt{\Omega_\text{cell}}\)</span>.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">coeff</span></code> passed to this function has shape <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>,
it can have any leading dimension.
It can be created using <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> and <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a>.
<a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> creates a raw parameter and <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a> converts
that parameter into coefficients that are used to linearly weight the 3D
fourier components.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>coeff</strong> – linear combination coefficients over the 3D fourier components.
shape is <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code> where <code class="code docutils literal notranslate"><span class="pre">(x</span> <span class="pre">y</span> <span class="pre">z)</span></code> is the shape of the
3D frequency components generated
from <code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>.</p></li>
<li><p><strong>vol</strong> – volume of the unit cell.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The result of evaluating the wave function on the specific spatial grid.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="jrystal._src.pw.wave_r">
<span class="sig-prename descclassname"><span class="pre">jrystal._src.pw.</span></span><span class="sig-name descname"><span class="pre">wave_r</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coeff</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cell_vectors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'3</span> <span class="pre">3'</span></span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">g_vector_grid</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Float</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'...</span> <span class="pre">n1</span> <span class="pre">n2</span> <span class="pre">n3'</span></span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">Complex</span><span class="p"><span class="pre">[</span></span><span class="pre">Array</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'spin</span> <span class="pre">kpts</span> <span class="pre">band</span> <span class="pre">*b'</span></span><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#jrystal._src.pw.wave_r" title="Link to this definition">#</a></dt>
<dd><p>Evaluate plane wave functions at location r.</p>
<dl class="simple">
<dt>TODO(litb): I think the g_vector_grid is not necessary, we can compute it from</dt><dd><p>cell_vectors. Otherwise, if we specify g_vector_grid and it is not
compatible with cell_vectors, then we shouldn’t use its vol. And also seem
very weird.</p>
</dd>
</dl>
<p>This function basically computes the <span class="math notranslate nohighlight">\(\psi(r)\)</span> following the equation</p>
<div class="math notranslate nohighlight">
\[\psi(r) = \frac{1}{\sqrt{\Omega_\text{cell}}} \sum_G c_{G} e^{iGr}\]</div>
<p>the <code class="code docutils literal notranslate"><span class="pre">coeff</span></code> provided is the <span class="math notranslate nohighlight">\(c_{G}\)</span>, the <code class="code docutils literal notranslate"><span class="pre">cell_vectors</span></code> is
used to generate the grid of frequency components $G$ by calling the function
<code class="xref py py-func docutils literal notranslate"><span class="pre">jrystal.grid.g_vectors()</span></code>. The <code class="code docutils literal notranslate"><span class="pre">r</span></code> is the location where we
evaluate the wave function.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">coeff</span></code> passed to this function has shape <code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>,
it can have leading batch dimensions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>r</strong> – spatial location to evaluate the wave function, shape: (3,).</p></li>
<li><p><strong>coeff</strong> – wave function coefficients, which has a shape of
<code class="code docutils literal notranslate"><span class="pre">(...,</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code>.
it can be created from <a class="reference internal" href="#jrystal._src.pw.param_init" title="jrystal._src.pw.param_init"><code class="xref py py-func docutils literal notranslate"><span class="pre">param_init()</span></code></a> followed by <a class="reference internal" href="#jrystal._src.pw.coeff" title="jrystal._src.pw.coeff"><code class="xref py py-func docutils literal notranslate"><span class="pre">coeff()</span></code></a>.</p></li>
<li><p><strong>cell_vectors</strong> – the cell vectors of the crystal unit cell.</p></li>
<li><p><strong>g_vector_grid</strong> – to be resolved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Complex tensor that represents wave functions evaluated at location r,
with shape of the leading dimensions of the coeff (…).</p>
</dd>
</dl>
</dd></dl>

</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.coeff"><code class="docutils literal notranslate"><span class="pre">coeff()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.density_grid"><code class="docutils literal notranslate"><span class="pre">density_grid()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.density_grid_reciprocal"><code class="docutils literal notranslate"><span class="pre">density_grid_reciprocal()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.density_r"><code class="docutils literal notranslate"><span class="pre">density_r()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.nabla_density_grid"><code class="docutils literal notranslate"><span class="pre">nabla_density_grid()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.nabla_density_r"><code class="docutils literal notranslate"><span class="pre">nabla_density_r()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.param_init"><code class="docutils literal notranslate"><span class="pre">param_init()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.wave_grid"><code class="docutils literal notranslate"><span class="pre">wave_grid()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jrystal._src.pw.wave_r"><code class="docutils literal notranslate"><span class="pre">wave_r()</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By SAIL AI4Science Team
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025, SEA AI LAB.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>